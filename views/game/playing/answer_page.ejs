<!-- PAGE ON WHICH THE USER SHOULD FILL IN THE BLANKS -->
<script src="/socket.io/socket.io.js"></script>
<script type="text/javascript">
    let socket = io.connect();
    let room = "<%= room_id %>";
    let current_sentence = "<%= c_sentence %>";

    socket.on('connect', function() {
        if(room != "")
            socket.emit('join_room', room);
    });

    socket.on('game_reload', function() {
        document.location.reload();
    });

    socket.on('game_answer_response', function(message, error, code) {
        if(error) {
            alert('Error: ' + error);
            console.error(message);
        }
        else {
            console.log(message);

            if(code == 1)
                alert('Waiting for the others to answer...');
        }
    });


    var inputArr = [];

    function submitAnswer() {
        let ans = "";
        for (let i = 0; i < inputArr.length; i++) {
            ans += inputArr[i].value;
            if(inputArr[i + 1])
                ans += "$$$";
        }

        socket.emit('user_answer', room, ans);
        // ans = "first hole sentence $$$ second hole sentence"
    }

    window.onload = function() {
        let splSentence = current_sentence.split("$$$");
        let container = document.getElementById('sentence-container');

        for (let i = 0; i < splSentence.length; i++) {
            let p = document.createElement("p");
            p.innerHTML = splSentence[i];
            container.appendChild(p);

            if(i < splSentence.length - 1) {
                let inp = document.createElement("input");
                container.appendChild(inp);
                inputArr.push(inp);
            }
        }
    };
</script>

<div class="answer_page">
    <p>Complete the following sentence (every hole must contain a number of chars between <%= min_chars %> and <%= max_chars %>) :</p>
    <div id="sentence-container">
    </div>

    <br /><input type="submit" onclick="submitAnswer()" value="Valider">
</div>
